<!DOCTYPE html>
<html>
<head>
    <script src="lib/event_emitter.js"></script>
    <script src="lib/model/model.js"></script>
    <script src="lib/model/collection.js"></script>
    <script src="lib/view/view.js"></script>
    <script src="lib/view/model_view.js"></script>
    <script src="lib/view/collection_view.js"></script>
    <script src="scripts/model/person.js"></script>
    <style>
    li .edit { display: none; }
    li.editing .show { display: none; }
    li.editing .edit { display: block }
    </style>
</head>
<body>
    <div id="in" >
        <form data-bind-event="submit addPerson">
            <input data-bind-value="name" autofocus placeholder="e.g. John Doe" required>
            <input value="Add" type="submit">
        </form>
    </div>
    <li>
        <div class="show">
            <span data-bind="name"></span>
            <a href="#" data-bind-event="click edit">Edit</a>
            <a href="#" data-bind-event="click remove">Delete</a>
        </div>
        <div class="edit">
            <input data-bind-value="newName" required>
            <a href="#" data-bind-event="click editOk">Confirm</a>
            <a href="#" data-bind-event="click editCancel">Cancel</a>
        </div>
    </li>
    <ul id="a"></ul>
<script>
var c = new Collection();

var newPerson = new Person();
var newView = new ModelView(document.getElementById("in"), newPerson);

newView.addPerson = function(e) {
    c.add(newPerson.clone());
    newPerson.name = "";
    e.preventDefault();
};


var modelTemplate = View.template(document.querySelector("li"));

modelTemplate.remove = function(e) {
    c.remove(this._model);
    e.preventDefault();
};

modelTemplate.edit = function(e) {
    this._model.newName = this._model.name;
    this._node.classList.add("editing");
    this.find("input").focus();
    e.preventDefault();
};

modelTemplate.editOk = function(e) {
    this._model.name = this._model.newName;
    this._node.classList.remove("editing");
    e.preventDefault();
};

modelTemplate.editCancel = function(e) {
    this._node.classList.remove("editing");
    e.preventDefault();
};

var coll = new CollectionView(View.capture(document.querySelector("ul")), c, modelTemplate);

document.body.appendChild(coll._node);

</script>
</body>
</html>
